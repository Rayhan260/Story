This is chapter 4 updated version